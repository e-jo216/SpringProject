<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.question.dao.QuestionMapper">  
  	<select id="selectList" parameterType="map" resultType="questionVO">
  		SELECT
  			*
  		FROM (SELECT
  				a.*,
  				rownum rnum
  			FROM (SELECT
  					q.num,
  					<![CDATA[
  					REPLACE(REPLACE(q.title,'<','&lt;'),'>','&gt;') title,
  					]]>
  					q.question_date,
  					q.m_num,
  					m.id
  				FROM question q JOIN member m ON q.m_num = m.num
  				<where>
  					<if test="keyword != '' and keyfield == 1">
  						q.title LIKE '%' || #{keyword} || '%'
  					</if>
  					<if test="keyword != '' and keyfield == 2">
  						m.id LIKE '%' || #{keyword} || '%'
  					</if>
  					<if test="keyword != '' and keyfield == 3">
  						q.content LIKE '%' || #{keyword} || '%'
  					</if>
  					<if test="keyword != '' and keyfield == 4">
  						q.title LIKE '%' || #{keyword} || '%' or 
  						q.content LIKE '%' || #{keyword} || '%'
  					</if>
  				</where>
  				ORDER BY q.num DESC)a)
  		<![CDATA[
  			WHERE rnum >= #{start} AND rnum <=#{end}
  		]]>
  	</select>
  	
  	<select id="selectRowCount" parameterType="map" resultType="integer">
  		SELECT
  			COUNT(*)
  		FROM question q JOIN member m ON q.m_num = m.num
  		<where>
			<if test="keyword != '' and keyfield == 1">
				q.title LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 2">
				m.id LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 3">
				q.content LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 4">
				q.title LIKE '%' || #{keyword} || '%' or 
				q.content LIKE '%' || #{keyword} || '%'
			</if>
		</where>
  	</select>
  
</mapper>







